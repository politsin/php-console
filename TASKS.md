# GNSS/Ublox: сбор, мониторинг и детекция спуфинга

## Цели
- Собирать NMEA/UBX с Ublox (Orange Pi Zero), отображать служебную инфо.
- В реальном времени понимать видимость спутников и дрейф точки.
- Детектировать GPS спуфинг и отправлять уведомления в Telegram.
- Хранить состояние в памяти (Redis). Опционально — InfluxDB + Grafana.
- Экспортировать события/снапшоты в JSON на вебхук.

## Минимальный инкремент (MVP)
1. Консольная команда `gnss:listen` читает поток NMEA с `/dev/ttyACM*`.
2. Парсинг GSV/GGA/RMC. В консоли — краткая сводка: время, fix, HDOP, кол-во SV, SNR min/avg/max.
3. Публикация актуального состояния в Redis (ключи `gnss:state:*`) с TTL.

## Следующие итерации
- InfluxDB sink: писать метрики (SNR, numSV, HDOP, lat/lon, alt) в `measurement=gnss`.
- Grafana: дашборд «видимость спутников», «дрейф позиции», «SNR по спутникам».
- Хуки: отправка JSON-событий на заданный вебхук.

## Детекция спуфинга (черновик критериев)
- Внезапный скачок координат при неизменном времени/скорости.
- Резкое изменение набора видимых спутников (замена большинства за < N сек).
- Аномальные SNR-профили (узкий диапазон, нехарактерная равномерность).
- Несоответствие времени GNSS локальному времени/инерционке (если появится).
- Пороговые значения конфигурируемые; алерты в Telegram с агрегацией/дедупликацией.

## Технические заметки
- PHP 8.4, Symfony Console, стиль Drupal. Короткие массивы `[]`, объединение `[...]`.
- Для UART используем существующие трейты, расширяем `UartTrait::initSerial`.
- Redis — без сохранения на диск (appendonly выключен), ключи с TTL.
- InfluxDB v2 (HTTP API), писать батчами.

## Команды (план)
- `gnss:listen` — чтение порта, парсинг, вывод краткой сводки, публикация в Redis.
- `gnss:spoof-watch` — эвристики, уведомления в Telegram, метрики в Influx.
- `gnss:export` — отправка снапшотов/событий на вебхук.

## Конфигурация (черновик env)
- `GNSS_PORT=/dev/ttyACM0`
- `GNSS_BAUD=9600`
- `REDIS_DSN=redis://127.0.0.1:6379`
- `INFLUX_URL=http://127.0.0.1:8086` `INFLUX_TOKEN=...` `INFLUX_ORG=...` `INFLUX_BUCKET=...`
- `TELEGRAM_BOT_TOKEN=...` `TELEGRAM_CHAT_ID=...`

## Граница данных
Всегда использовать реальные данные модема; при недоступности источника — пустые значения/ошибки, без синтетики.


